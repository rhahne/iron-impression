{{> nav}}
<section class="section">
    <div class="container">
        <div class="columns">
            <div class="column">
                <p class="content">
                    <h1 class="title">{{resume.title}}</h1>
                    <strong>Description:</strong> <br>
                    {{resume.feedbackDescription}} <br><br>
                    <strong>Type of help:</strong> <br>
                    {{resume.feedbackTypes}}
                    <br><br>
                    {{#if loggedUser}}
                    <a href="/community/resume/edit/{{resume.id}}">
                        <button class="button is-primary">
                            Edit
                        </button>
                    </a>
                    <br><br>
                    <a href="/community/resume/delete/{{resume.id}}">
                        <button class="button is-dark">
                            Delete
                        </button>
                    </a>
                    {{/if}}
                    <br><br>
                    <a href="{{resume.path}}">
                        <button class="button is-light">
                            Download the PDF
                        </button>
                    </a>
                    <a href="/community/resume/show?path={{resume.path}}">
                        <button class="button is-light">
                            Show me what you've got
                        </button>
                    </a>
                </p>
            </div>
            <div class="column">
                <canvas id="pdf-canvas" class="canvas-pdf"></canvas>
            </div>
        </div>
        <script>
            pdfjsLib.getDocument('{{resume.path}}')
                .then((doc) => {
                    doc.getPage(1).then((page) => {
                        var myCanvas = document.getElementById("pdf-canvas")
                        var context = myCanvas.getContext("2d")

                        var viewport = page.getViewport(1);
                        myCanvas.width = viewport.width;
                        myCanvas.height = viewport.height;

                        page.render({
                            canvasContext: context,
                            viewport: viewport
                        })
                    })
                })
                .catch((err) => {
                    console.log(err)
                })
        </script>
        <br><br><br>
        <hr><br><br><br>
        {{!-- Write comment --}}
        <article class="media">
            <figure class="media-left">
                <p class="image is-64x64">
                    <img src="/img/avatars/avatar-{{avatarNumber}}.svg">
                </p>
            </figure>
            <div class="media-content">
                <div class="field">
                    <p class="control">
                        <form action="/community/resume/details/{{resume.id}}/comment" method="POST">
                            <textarea name="text" rows="2" class="textarea" placeholder="Add a comment..."></textarea>
                    </p>
                </div>
                <div class="field">
                    <p class="contol">
                        <button type="submit" class="button">Post comment</button>
                        </form>
                    </p>
                </div>
            </div>
            <br>
        </article>
        {{!-- Comments --}}
        {{#each comments}}
        <article class="media">
            <figure class="media-left">
                <p class="image is-64x64">
                    <img src="/img/avatars/avatar-{{this.user.avatarNumber}}.svg">
                </p>
            </figure>
            <div class="media-content">
                <div class="content">
                    <p>
                        <strong>{{this.user.firstName}} {{this.user.lastName}}</strong>
                        <div class="toggle{{this.id}}">
                            {{this.text}}
                            <br>
                        </div>
                        <div class="toggle{{this.id}} hidden">
                            <form action="/community/resume/editComment/{{this.id}}" method="POST">
                                <textarea name="text" rows="2" class="textarea" placeholder="Add a comment...">{{this.text}}</textarea><br>
                                <button class="button">Update Comment!</button>
                            </form>
                            {{!-- <small><a>Like</a> · <a>Reply</a> · 3 hrs</small> --}}
                        </div>
                        {{#if this.myComment}}
                        <small>
                            <a id="edit{{this.id}}" id="edit{{this.id}}">
                                edit
                            </a>
                            <a href="/community/resume/deleteComment/{{this.id}}">
                                delete
                            </a>
                        </small>
                        {{!--
                        <button id="edit{{this.id}}" class="button is-dark">
                            edit
                        </button>
                        <a href="/community/resume/deleteComment/{{this.id}}">
                            <button class="button is-dark">
                                Delete
                            </button>
                        </a> --}}
                        {{/if}}
                        <br>
                        <script>
                            $("#edit{{this.id}}").click(() => {
                                $('.toggle{{this.id}}').toggleClass('hidden');
                            });
                        </script>
                    </p>
                </div>
            </div>
        </article>
        {{/each}}
    </div>
</section>